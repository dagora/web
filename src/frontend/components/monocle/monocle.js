/* monocle v1.0.3 - 2013/3/8
   http://monocle.tapquo.com
   Copyright (c) 2013 Javi Jim√©nez Villar - Licensed MIT */
var Events,Module,Monocle,moduleKeywords,__slice=[].slice,__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};Events={bind:function(e,t){var n,r,i,s,o;r=e.split(" "),n=this.hasOwnProperty("_callbacks")&&this._callbacks||(this._callbacks={});for(s=0,o=r.length;s<o;s++)i=r[s],n[i]||(n[i]=[]),n[i].push(t);return this},trigger:function(){var e,t,n,r,i,s,o;e=1<=arguments.length?__slice.call(arguments,0):[],n=e.shift(),r=this.hasOwnProperty("_callbacks")&&((o=this._callbacks)!=null?o[n]:void 0);if(!r)return;for(i=0,s=r.length;i<s;i++){t=r[i];if(t.apply(this,e)===!1)break}return!0},unbind:function(e,t){var n,r,i,s,o,u;if(!e)return this._callbacks={},this;i=(u=this._callbacks)!=null?u[e]:void 0;if(!i)return this;if(!t)return delete this._callbacks[e],this;for(r=s=0,o=i.length;s<o;r=++s){n=i[r];if(n!==t)continue;i=i.slice(),i.splice(r,1),this._callbacks[e]=i;break}return this}},moduleKeywords=["included","extended"],Module=function(){function e(){typeof this.init=="function"&&this.init.apply(this,args)}return e.include=function(e){var t,n,r;if(!e)throw new Error("include(obj) requires obj");for(n in e)r=e[n],__indexOf.call(moduleKeywords,n)<0&&(this.prototype[n]=r);return t=e.included,t&&t.apply(this),this},e.extend=function(e){var t,n,r;if(!e)throw new Error("extend(obj) requires obj");for(t in e)n=e[t],__indexOf.call(moduleKeywords,t)<0&&(this[t]=n);return(r=e.extended)!=null&&r.apply(this),this},e.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}},e.prototype.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}},e.prototype.delay=function(e,t){return setTimeout(this.proxy(e),t||0)},e}(),Monocle=this.Monocle={},Monocle.version="1.0.2",Monocle.Events=Events,Monocle.Module=Module,Monocle.Templates={},Monocle.Dom=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],typeof $$!="undefined"&&$$!==null?$$.apply(null,e):$.apply(null,e)},Module.extend.call(Monocle,Events),Module.create=function(e,t){var n;return n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t}(this),e&&n.include(e),t&&n.extend(t),typeof n.unbind=="function"&&n.unbind(),n},this.__=Monocle.App={Model:{},View:{},Controller:{}},this.__Model=Monocle.App.Model,this.__View=Monocle.App.View,this.__Controller=Monocle.App.Controller;var guid,__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__slice=[].slice;Monocle.Model=function(e){function t(e){t.__super__.constructor.apply(this,arguments),this.className=this.constructor.name,e&&this.load(e),this.uid=this.constructor.uid()}return __extends(t,e),t.extend(Monocle.Events),t.records={},t.attributes=[],t.fields=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],this.records={},e.length&&(this.attributes=e),this.attributes||(this.attributes=[]),this.unbind(),this},t.create=function(e){var t;return t=new this(e),t.save()},t.uid=function(){var e;return e=guid()},t.exists=function(e){try{return this.find(e)}catch(t){return!1}},t.find=function(e){var t;return t=this.records[e],t.clone()},t.findBy=function(e,t){var n,r,i;i=this.records;for(r in i){n=i[r];if(n[e]===t)return n.clone()}},t.select=function(e){var t,n,r;return n=function(){var n,i;n=this.records,i=[];for(r in n)t=n[r],e(t)&&i.push(t);return i}.call(this),this.cloneArray(n)},t.each=function(e){var t,n,r,i;r=this.records,i=[];for(t in r)n=r[t],i.push(e(n.clone()));return i},t.all=function(){return this.cloneArray(this.recordsValues())},t.count=function(){return this.recordsValues().length},t.cloneArray=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],i.push(t.clone());return i},t.recordsValues=function(){var e,t,n,r;t=[],r=this.records;for(e in r)n=r[e],t.push(n);return t},t.destroyAll=function(){return this.records={}},t.prototype.isNew=function(){return!this.exists()},t.prototype.exists=function(){return this.uid&&this.uid in this.constructor.records},t.prototype.clone=function(){return createObject(this)},t.prototype.load=function(e){var t,n;for(t in e)n=e[t],typeof this[t]=="function"&&this[t](n),this[t]=n;return this},t.prototype.attributes=function(){var e,t,n,r,i;t={},i=this.constructor.attributes;for(n=0,r=i.length;n<r;n++)e=i[n],e in this&&(typeof this[e]=="function"?t[e]=this[e]():t[e]=this[e]);return t},t.prototype.equal=function(e){return!!e&&e.constructor===this.constructor&&!!e.uid&&e.uid===this.uid},t.prototype.save=function(){var e,t;return this.validate!=null&&(e=this.validate()),e?(this.trigger("error",e),!1):(this.trigger("beforeSave"),t=this.isNew()?this.create():this.update(),this.trigger("save"),t)},t.prototype.updateAttributes=function(e){return this.load(e),this.save()},t.prototype.changeUID=function(e){var t;return t=this.constructor.records,t[e]=t[this.uid],delete t[this.uid],this.uid=e,this.save()},t.prototype.create=function(){var e;return this.trigger("beforeCreate"),e=new this.constructor(this.attributes()),e.uid=this.uid,this.constructor.records[this.uid]=e,this.trigger("create"),this.trigger("change","create"),e.clone()},t.prototype.update=function(){var e;return this.trigger("beforeUpdate"),e=this.constructor.records,e[this.uid].load(this.attributes()),this.trigger("update"),this.trigger("change","update"),e[this.uid].clone()},t.prototype.destroy=function(){return this.trigger("beforeDestroy"),delete this.constructor.records[this.uid],this.trigger("destroy"),this.trigger("change","destroy"),this.unbind(),this},t.prototype.clone=function(){return Object.create(this)},t.prototype.unbind=function(){return this.trigger("unbind")},t.prototype.trigger=function(){var e,t;return e=1<=arguments.length?__slice.call(arguments,0):[],e.splice(1,0,this),(t=this.constructor).trigger.apply(t,e)},t}(Monocle.Module),typeof Object.create!="function"&&(Object.create=function(e){var t;return t=function(){},t.prototype=e,new t}),guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t,n;return t=Math.random()*16|0,n=e==="x"?t:t&3|8,n.toString(16)}).toUpperCase()};var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};Monocle.Controller=function(e){function t(e){this.destroy=__bind(this.destroy,this);var n,r;if(typeof e=="string")this.el=Monocle.Dom(e);else for(n in e)r=e[n],this[n]=r;this.el||(this.el=Monocle.Dom(document.createElement(this.tag))),this.events||(this.events=this.constructor.events),this.elements||(this.elements=this.constructor.elements),this.events&&this.delegateEvents(),this.elements&&this.refreshElements(),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.include(Monocle.Events),t.prototype.eventSplitter=/^(\S+)\s*(.*)$/,t.prototype.tag="div",t.prototype.delegateEvents=function(){var e,t,n,r,i,s,o;s=this.events,o=[];for(t in s)r=s[t],typeof r!="function"&&(r=this.proxy(this[r])),n=t.match(this.eventSplitter),e=n[1],i=n[2],i===""?o.push(this.el.bind(e,r)):o.push(this.el.delegate(i,e,r));return o},t.prototype.refreshElements=function(){var e,t,n,r;n=this.elements,r=[];for(e in n)t=n[e],r.push(this[t]=this.el.find(e));return r},t.prototype.destroy=function(){return this.trigger("release"),this.el.remove(),this.unbind()},t}(Monocle.Module);var __hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__slice=[].slice;Monocle.View=function(e){function t(e){t.__super__.constructor.apply(this,arguments),this.template||(this.template=this.constructor.template),this.template||this._loadTemplateFrom(this.template_url),this.container||(this.container=this.constructor.container),this.container=Monocle.Dom(this.container),this.container.attr("data-monocle",this.constructor.name)}return __extends(t,e),t.container=void 0,t.template_uri=void 0,t.template=void 0,t.model=void 0,t.prototype.html=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],this._html.apply(this,["html"].concat(__slice.call(e)))},t.prototype.append=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],this._html.apply(this,["append"].concat(__slice.call(e)))},t.prototype.prepend=function(){var e;return e=1<=arguments.length?__slice.call(arguments,0):[],this._html.apply(this,["prepend"].concat(__slice.call(e)))},t.prototype.remove=function(){return this.model.destroy(),this.el.remove()},t.prototype.replace=function(e){var t,n;return n=[this.el,Monocle.Dom(e.el||e)],t=n[0],this.el=n[1],t.replaceWith(this.el),this.delegateEvents(this.events),this.refreshElements(),this.el},t.prototype.refresh=function(){var e;return e=Monocle.templayed(this.template)(this.model),this.replace(e)},t.prototype._html=function(){var e,t,n,r;return n=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],t=function(){var n,r,i;i=[];for(n=0,r=t.length;n<r;n++)e=t[n],i.push(e.el||e);return i}(),r=Monocle.templayed(this.template).apply(null,t),this.replace(r),this.container[n](this.el),this},t.prototype._loadTemplateFrom=function(e){var t,n,r;t=this.constructor.name;if(!Monocle.Templates[t]){n=typeof $$!="undefined"&&$$!==null?$$:$,r=n.ajax({url:e,async:!1,dataType:"text",error:function(){return console.error(arguments)}});if(typeof $$=="undefined"||$$===null)r=r.responseText;Monocle.Templates[t]=r}return this.template=Monocle.Templates[t]},t}(Monocle.Controller),Monocle.templayed=function(e,t){var n,r,i,s;return r=function(e,t){var n,r,i;t=1,e=e.replace(/\.\.\//g,function(){return t++,""}),r=["data[data.length - ",t,"]"],i=e==="."?[]:e.split("."),n=0;while(n<i.length)r.push("."+i[n]),n++;return r.join("")},s=function(e){return e.replace(/\{\{(!|&|\{)?\s*(.*?)\s*}}+/g,function(e,t,n){var s;return t==="!"?"":(s=i++,['"; var o',s," = ",r(n),", s",s," = (((typeof(o",s,') == "function" ? o',s,".call(data[data.length - 1]) : o",s,') || "") + ""); s += ',t?"s"+s:'(/[&"><]/.test(s'+s+") ? s"+s+'.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/>/g,"&gt;").replace(/</g,"&lt;") : s'+s+")",' + "'].join(""))})},n=function(e){return s(e.replace(/\{\{(\^|#)(.*?)}}(.*?)\{\{\/\2}}/g,function(e,t,s,o){var u;return u=i++,['"; var o',u," = ",r(s),"; ",(t==="^"?["if ((o",u," instanceof Array) ? !o",u,".length : !o",u,') { s += "',n(o),'"; } ']:["if (typeof(o",u,') == "boolean" && o',u,') { s += "',n(o),'"; } else if (o',u,") { for (var i",u," = 0; i",u," < o",u,".length; i",u,"++) { data.push(o",u,"[i",u,']); s += "',n(o),'"; data.pop(); }}']).join(""),'; s += "'].join("")}))},i=0,new Function("data",'data = [data], s = "'+n(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"))+'"; return s;')};var escapeRegExp,hashStrip,namedParam,splatParam,__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t)__hasProp.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},__slice=[].slice;Monocle.Route=function(e){function n(e,t){var n;this.path=e,this.callback=t,this.names=[];if(typeof e=="string"){namedParam.lastIndex=0;while((n=namedParam.exec(e))!==null)this.names.push(n[1]);splatParam.lastIndex=0;while((n=splatParam.exec(e))!==null)this.names.push(n[1]);e=e.replace(escapeRegExp,"\\$&").replace(namedParam,"([^/]*)").replace(splatParam,"(.*?)"),this.route=new RegExp("^"+e+"$")}else this.route=e}var t;return __extends(n,e),n.extend(Monocle.Events),n.historySupport=((t=window.history)!=null?t.pushState:void 0)!=null,n.routes=[],n.options={trigger:!0,history:!1},n.listen=function(e){return e==null&&(e={}),this.options=this.extend(this.options,e),this.options.history&&(this.history=this.historySupport&&this.options.history),Monocle.Dom(window).bind(this.getEventName(),this.change),this.change()},n.add=function(e,t){var n,r,i;if(typeof e!="object"||e instanceof RegExp)return this.routes.push(new this(e,t));i=[];for(n in e)r=e[n],i.push(this.add(n,r));return i},n.unbind=function(){return Monocle.Dom(window).unbind(this.getEventName(),this.change)},n.navigate=function(){var e,t,n,r;return e=1<=arguments.length?__slice.call(arguments,0):[],n={},t=e[e.length-1],typeof t=="object"?n=e.pop():typeof t=="boolean"&&(n.trigger=e.pop()),n=this.extend(this.options,n),r=e.join("/"),r!==this.path&&(this.path=r,this.trigger("navigate",this.path),n.trigger&&this.matchRoute(this.path,n),this.history?history.pushState({},document.title,this.path):window.location.hash=this.path),this},n.extend=function(e,t){var n,r;e==null&&(e={});for(n in t)r=t[n],e[n]=r;return e},n.getEventName=function(){return this.history?"popstate":"hashchange"},n.getPath=function(){var e;return e=window.location.pathname,e.substr(0,1)!=="/"&&(e="/"+e),e},n.getFragment=function(){return this.getHash().replace(hashStrip,"")},n.getHost=function(){return(document.location+"").replace(this.getPath()+this.getHash(),"")},n.getHash=function(){return window.location.hash},n.change=function(){var e;return e=this.history?this.getPath():this.getFragment(),e!==this.path&&(this.path=e,this.matchRoute(this.path)),this},n.matchRoute=function(e,t){var n,r,i,s;s=this.routes;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.match(e,t))return this.trigger("change",n,e),n}},n.prototype.match=function(e,t){var n,r,i,s,o,u;t==null&&(t={}),r=this.route.exec(e);if(!r)return!1;t.match=r;if(this.names.length){u=r.slice(1);for(n=s=0,o=u.length;s<o;n=++s)i=u[n],t[this.names[n]]=i}return this.callback.call(null,t)!==!1},n}(Monocle.Module),hashStrip=/^#*/,namedParam=/:([\w\d]+)/g,splatParam=/\*([\w\d]+)/g,escapeRegExp=/[-[\]{}()+?.,\\^$|#\s]/g,Monocle.Route.change=Monocle.Route.proxy(Monocle.Route.change),Monocle.Controller.include({route:function(e,t){return Monocle.Route.add(e,this.proxy(t))},routes:function(e){var t,n,r;r=[];for(t in e)n=e[t],r.push(this.route(t,n));return r},url:function(){return Monocle.Route.navigate.apply(Monocle.Route,arguments)}});
